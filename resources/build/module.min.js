function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=new Array(t);a<t;a++)o[a]=e[a];return o}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o,n,c,i,r=[],s=!0,l=!1;try{if(c=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;s=!1}else for(;!(s=(o=c.call(a)).done)&&(r.push(o.value),r.length!==t);s=!0);}catch(e){l=!0,n=e}finally{try{if(!s&&null!=a.return&&(i=a.return(),Object(i)!==i))return}finally{if(l)throw n}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){_defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _defineProperty(e,t,a){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(e){var t=e.mapster.utils;function a(a,o,n,c,i){if(e.isArray(o)&&(o=o[0]),o&&"AREA"===o.nodeName&&"rect"===o.shape){var r=function(e,a,o,n){var c=t.split(e.coords,parseInt),i=c[0],r=c[1],s=c[2],l=c[3],f=s-i,d=n.outerWidth(!0),p=n.outerHeight(!0),u=i+f/2,m=0;u-d/2>0&&(m=u-d/2),u+d/2>a.width&&(m=a.width-d);var y=l;return y+p>a.height&&(y=r-p),[m,y]}(o,n,e(".faces-mapster-wrapper"),a);return a.css({left:r[0]+"px",top:r[1]+"px",opacity:1})}console.error("Unexpected behavior!")}function o(t,a,o,n,c,i){var r=o+".mapster-tooltip";if(e.inArray(a,t)>=0)return n.unbind(r).bind(r,(function(e){c&&!c.call(this,e)||(n.unbind(".mapster-tooltip"),i&&i.call(this))})),{object:n,event:r}}e.mapster.AreaData.prototype.showToolTip=function(n,c){var i,r,s,l,f,d=this,p=d.owner,u=d.effectiveOptions();if(c=c?e.extend({},c):{},n=n||u.toolTip,r=c.closeEvents||u.toolTipClose||p.options.toolTipClose||"tooltip-click",f=void 0!==c.template?c.template:p.options.toolTipContainer,c.closeEvents="string"==typeof r?r=t.split(r):r,c.fadeDuration=c.fadeDuration||(p.options.toolTipFade?p.options.fadeDuration||u.fadeDuration:0),s=d.area?d.area:e.map(d.areas(),(function(e){return e.area})),p.activeToolTipID!==d.areaId)return p.clearToolTip(),p.activeToolTip=i=function(t,a,o){var n;return a?(n="string"==typeof a?e(a):e(a).clone()).append(t):n=e(t),n.css(e.extend(o||{},{display:"block",position:"absolute",opacity:0})),e(".faces-mapster-wrapper").append(n),n}(n,f,c.css),p.activeToolTipID=d.areaId,l=function(){p.clearToolTip()},o(r,"area-click","click",e(p.map),null,l),o(r,"tooltip-click","click",i,null,l),o(r,"image-mouseout","mouseout",e(p.image),(function(e){return e.relatedTarget&&"AREA"!==e.relatedTarget.nodeName&&e.relatedTarget!==d.area}),l),a(i,s,p.image,c.container,0),t.ifFunction(p.options.onShowToolTip,d.area,{toolTip:i,options:{},areaOptions:u,key:d.key,selected:d.isSelected()}),i}}(jQuery);var facesMid=null,facesFact=null,useSznupa=null,facesMode="mark",facesIsMobile=null!==new MobileDetect(window.navigator.userAgent).mobile();function facesRoute(e,t){return window.WT_FACES.routes[e].replace("FACES_ACTION",t)}function facesIndex(e,t){facesMid=e,facesFact=t;var a={};!0===useSznupa?a.sznupa=1:!1===useSznupa&&(a.sznupa=0),$.ajax({url:facesRoute("data","index"),type:"GET",data:_objectSpread({mid:e,fact:t},a)}).done((function(e){facesRenderPeoples(e.map,e.edit,e.title,e.meta,e.url,e.note,e.type,e.estimated_date_range,e.sznupa)}))}function facesAttach(e,t,a,o){$.ajax({url:facesRoute("data","attach"),type:"POST",data:{mid:e,fact:t,pid:a.pid,coords:a.coords}}).done((function(e){facesRefresh(),o&&null!==e.linker&&$.ajax({url:e.linker.url,type:"POST",data:e.linker.data})}))}function facesDetach(e,t,a){$.ajax({url:facesRoute("data","detach"),type:"POST",data:{mid:e,fact:t,pid:a.pid}}).done((function(){facesRefresh()}))}function facesRefresh(){var e=$.fancybox.getInstance();e.jumpTo(e.currIndex)}function facesClean(e){var t=e.$refs.stage.find(".fancybox-slide--current img.fancybox-image");t.length&&(t.mapster("tooltip"),t.mapster("unbind"),t.parents("pinch-zoom").length&&t.unwrap("pinch-zoom")),$("#faces-map").remove()}function facesRenderPeoples(e,t,a,o,n,c,i,r,s){var l=$.fancybox.getInstance();!1===s.enabled&&(useSznupa=!1);var f=l.$refs.caption.find(".fancybox-caption__body"),d=l.$refs.stage.find(".fancybox-slide--current img.fancybox-image");l.$refs.container.toggleClass("faces-readonly",!(t&&!facesIsMobile));var p="faces-map-"+Date.now(),u=$("<map/>",{id:"faces-map",name:p}),m=[],y=[];d.attr("usemap","#"+p).after(u),$.each(e,(function(e,a){var o=null!==a.link?a.link:"#",n=encodeURIComponent(a.pid);u.append($("<area/>",{shape:a.coords.length>4?"poly":"rect",coords:a.coords.join(","),href:o,"data-key":n})),m.push({key:n,toolTip:tmpl($("#faces-tooltip-template").html(),{person:a})});var c=tmpl($("#faces-person-template").html(),{person:a,key:n,link:o,edit:t&&!facesIsMobile});y.push(c)})),document.addEventListener("keydown",(function(e){"Control"===e.key&&(document.querySelector("img.mapster_el").style.opacity="0.7")})),document.addEventListener("keyup",(function(e){"Control"===e.key&&(document.querySelector("img.mapster_el").style.opacity="1")})),d.mapster({isSelectable:!1,wrapClass:"faces-mapster-wrapper",mapKey:"data-key",fillColor:"000000",fillOpacity:0,stroke:!0,strokeColor:"3b5998",strokeWidth:2,showToolTip:!0,areas:m,toolTipContainer:'<div class="faces-tooltip"></div>',toolTipClose:facesIsMobile?"area-mouseout":["area-mouseout","image-mouseout"],onClick:facesIsMobile?null:function(t){if(t.e.ctrlKey){var a=decodeURIComponent(t.key),o=e.find((function(e){return e.pid===a})),n=$($("#faces-attach-modal-template").html());n.on("shown.bs.modal",(function(){$(".modal-backdrop").before(n)})),n.on("hidden.bs.modal",(function(){n.remove()}));var c=webtrees.initializeTomSelect(n.find("select.tom-select")[0]);return c.settings.create=!0,o.guess&&(c.addOption(o.guess.map((function(e){return{value:e.pid,text:e.text}}))),c.open()),n.find("#faces-attach-button").on("click",(function(){var e=n.find("#faces-attach-pid").find(":selected");if(e.length&&e.val()){var a=d.get(0),o=a.height,c=a.width,i=a.naturalHeight,r=a.naturalWidth,s=_slicedToArray(t.e.target.coords.split(",").map((function(e){return parseInt(e)})),4),l=s[0],f=s[1],p=s[2],u=s[3],m=i/o,y=r/c;facesAttach(facesMid,facesFact,{pid:e.val(),coords:[l*y,f*m,p*y,u*m].map((function(e){return Math.round(e)}))},!e.is('[data-select2-tag="true"]'))}n.modal("hide")})),n.find("[data-dismiss]").on("click",(function(){n.modal("hide")})),n.on("keydown",(function(e){"Escape"===e.key&&n.modal("hide"),e.stopPropagation()})),$("body").append(n),n.modal("show"),n.find("#faces-attach-button").focus(),!1}var i=$(t.e.target).attr("href");return"#"!==i&&(window.location=i),!1}});var b=$("<div>");if(m.length&&(b.html(y.join("")),b.append(tmpl($("#faces-highlight-all-template").html(),{}))),null===i||"PHOTO"===i){var h=s.enabled?'\n            <button class="btn btn-sm btn-secondary" id="reindex-photo" title="'.concat(s.labels.LBL_SZNUPA_ANALYZE_TITLE,'">\n                ').concat(s.labels[s.indexed?"LBL_SZNUPA_ANALYZE_AGAIN":"LBL_SZNUPA_ANALYZE"],"\n            </button>\n        "):"";b.append('\n            <div style="padding-top: 20px; margin-top: 20px; border-top: 1px solid #ddd; display: flex; flex-direction: column; gap: 10px;">\n                <div class="form-check form-switch">\n                    <label class="form-check-label">\n                        <input class="form-check-input" type="checkbox" role="switch" id="sznupa-switch" style="cursor: pointer" '.concat(s.enabled?"checked":"",">\n                        ").concat(s.labels.LBL_SZNUPA_ACTIVATE,'\n                    </label>\n                </div>\n                <div class="text-danger">').concat(s.warning,"</div>\n                ").concat(h,"\n            </div>\n        "))}c&&b.prepend('<div class="faces-note">'.concat(c,"</div>"));var g=!0;$.each(o,(function(e,t){$.each(t,(function(e,t){"DATE"===e&&(g=!1),b.prepend('<div class="faces-subtitle">'+t+"</div>")}))})),g&&b.prepend('<div class="faces-subtitle">'+r+"</div>"),b.prepend('<div class="faces-title"><a href="'.concat(n,'">').concat(a,"</a></div>")),f.empty(),f.append(b),facesBindCaptionActions(d,l),facesBindToolbarActions(d,l)}function facesRenderZoom(){var e=$.fancybox.getInstance(),t=e.$refs.stage.find(".fancybox-slide--current img.fancybox-image");t.wrap("<pinch-zoom></pinch-zoom>"),facesBindToolbarActions(t,e)}function facesBindCaptionActions(e,t){t.$refs.caption.find(".faces-highlight-all").off("click").on("click",(function(){t.$refs.caption.find(".faces-person-name").each((function(){e.mapster("highlight",$(this).data("key"))}))})),t.$refs.caption.find(".faces-person-name").on("mouseenter",(function(t){var a=$(t.target).data("key");e.mapster("highlight",a),e.mapster("tooltip",a)})),t.$refs.caption.find(".faces-person-name").on("mouseleave",(function(){e.mapster("highlight",!1),e.mapster("tooltip",!1)})),t.$refs.caption.find(".faces-person-detach").on("click",(function(t){var a=$(t.target),o=$(tmpl($("#faces-detach-modal-template").html(),{name:a.data("name")}));o.on("shown.bs.modal",(function(){e.mapster("tooltip"),$(".modal-backdrop").before(o)})),o.on("hidden.bs.modal",(function(){o.remove()})),o.find("#faces-detach-button").on("click",(function(){var e=a.data("pid");e&&facesDetach(facesMid,facesFact,{pid:e}),o.modal("hide")})),o.find("[data-dismiss]").on("click",(function(){o.modal("hide")})),$("body").append(o),o.modal("show")})),t.$refs.caption.find("#sznupa-switch").on("click",(function(){useSznupa=$(this).is(":checked"),facesRefresh()})),t.$refs.caption.find("#reindex-photo").on("click",(function(){$.ajax({url:facesRoute("data","sznupa-reset"),type:"POST",data:{mid:facesMid,fact:facesFact}}).done((function(){facesRefresh()}))}))}function facesBindToolbarActions(e,t){t.$refs.toolbar.find("[data-fancybox-fzoom]").off("click").on("click",(function(){facesMode="mark"===facesMode?"zoom":"mark",facesRefresh()})),t.$refs.toolbar.find("[data-fancybox-fconfig]").off("click").on("click",(function(){var e=facesRoute("admin","config"),t=e.indexOf("?")>0?"&":"?";window.location=e+t+"mid="+facesMid})),t.$refs.toolbar.find("[data-fancybox-fadd]").off("click").on("click",(function(){t.$refs.container.toggleClass("faces-select",!0);var a=e.imgAreaSelect({handles:!1,autoHide:!0,show:!0,instance:!0,parent:e.parents(".fancybox-content"),imageHeight:e.get(0).naturalHeight,imageWidth:e.get(0).naturalWidth,onSelectEnd:function(o,n){t.$refs.container.toggleClass("faces-select",!1);var c=$($("#faces-attach-modal-template").html());c.on("shown.bs.modal",(function(){e.mapster("tooltip"),$(".modal-backdrop").before(c)})),c.on("hidden.bs.modal",(function(){c.remove()})),webtrees.initializeTomSelect(c.find("select.tom-select")[0]).settings.create=!0,c.find("#faces-attach-button").on("click",(function(){var e=c.find("#faces-attach-pid").find(":selected");e.length&&e.val()&&facesAttach(facesMid,facesFact,{pid:e.val(),coords:[n.x1,n.y1,n.x2,n.y2]},!e.is('[data-select2-tag="true"]')),c.modal("hide")})),c.find("[data-dismiss]").on("click",(function(){c.modal("hide")})),c.on("keydown",(function(e){"Escape"===e.key&&c.modal("hide"),e.stopPropagation()})),$("body").append(c),c.modal("show"),c.find("#faces-attach-button").focus(),a.cancelSelection(),a.remove()}})})),t.$refs.toolbar.find("[data-fancybox-frefresh]").off("click").on("click",(function(){facesRefresh()}))}$.colorbox.remove(),$("body").off("click","a.gallery"),$.fancybox.defaults.btnTpl.fzoom=$.fancybox.defaults.btnTpl.zoom.replace(/zoom/g,"fzoom"),$.fancybox.defaults.btnTpl.fadd=$.fancybox.defaults.btnTpl.close.replace(/close/g,"fadd").replace("{{CLOSE}}","Add"),$.fancybox.defaults.btnTpl.fconfig='<button data-fancybox-fconfig class="fancybox-button fancybox-button--fconfig" title="Settings" style="padding: 14px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path></svg></button>',$.fancybox.defaults.btnTpl.frefresh='<button data-fancybox-frefresh class="fancybox-button fancybox-button--frefresh" title="Refresh" style="padding: 14px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M386.3 160L336 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l128 0c17.7 0 32-14.3 32-32l0-128c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 51.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0s-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3s163.8-62.5 226.3 0L386.3 160z"/></svg></button>',$().fancybox({selector:"a[type^=image].gallery",baseClass:"fancybox-faces-layout",infobar:!1,protect:!1,touch:{vertical:!1},buttons:["close","slideShow","fzoom","fadd","fconfig","frefresh"],animationEffect:"fade",transitionEffect:"fade",preventCaptionOverlap:!1,idleTime:!1,gutter:0,clickOutside:!1,clickSlide:!1,trapFocus:!1,clickContent:!1,wheel:!1,beforeLoad:function(e){e.$refs.container.toggleClass("faces-zoom","mark"!==facesMode)},beforeClose:function(e){facesClean(e)},beforeShow:function(e){e.$refs.container.toggleClass("faces-zoom","mark"!==facesMode),facesClean(e)},afterShow:function(e,t){var a=new RegExp("[?&]xref=([^&#]*)").exec(t.src)[1],o=new RegExp("[?&]fact_id=([^&#]*)").exec(t.src)[1];"mark"===facesMode?(t.opts.caption='<div class="fancybox-loading"></div>',e.updateControls(),facesIndex(a,o)):facesRenderZoom()}});
